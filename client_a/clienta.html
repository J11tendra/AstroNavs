<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Work+Sans:ital,wght@0,100..900;1,100..900&display=swap"
    rel="stylesheet" />
  <style>
    body {
      height: 100vh;
      margin: 0;
      overflow: hidden;
      font-family: "Press Start 2P", system-ui;
      font-size: 22px;
      text-shadow: 1px 1px limegreen;
      border-style: solid;
      border-width: 10px;
    }

    div {
      height: 95%;
      width: 40%;
    }

    #translationtable {
      width: 100%;
      text-align: center;
    }

    #table1 {
      height: 100%;
      width: 100%;
      margin-left: 5%;
    }

    #table2 {
      height: 100%;
      width: 70%;
      margin-left: 5%;
      text-align: center;
    }

    img {
      height: auto;
      height: 96.5%;
      border-style: solid;
      border-width: 1px;
      margin: auto;
      /* I don't know how to scale SVGs :( */
    }

    #gameover {
      background-color: rgba(0, 0, 0, 0.8);
      position: fixed;
      height: 100%;
      width: 100%;
      text-align: center;
      display: none;
    }
  </style>
  <title>AstroNavs: Client A</title>
</head>

<body>
  <div id="gameover">
    <h1 style="margin-top:5%;">GAME OVER</h1>
  </div>
    <table id="table1">
      <tr>
        <td style="text-align: center;">Your Symbols Are</td>
      </tr>
    </table>
  <script>

    /*Not sure how the game rooms are assigned or how the clients are decided
    if /connect already needs the game rooms and clients to be decided?? I didn't
    understand the server code help*/
    let symbols = [];
    let current_move = 0;
    let game_over = false;

    const room_id = "101"

    //Link for connecting to the game
    async function connect() {
      response = await fetch('/connect', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/JSON'
        },
        body: JSON.stringify({
          client: 'a', //client
          game_room: room_id //game room, change from hard coded to command line
        })
      })
        .then(() => pollForCoordinates())
        .then(() => addImagesCorrespondingToCoordinates())
        .then(() => gameLoop())
    }

    async function gameLoop() {
      while(game_over == false){
          pollForCoordinates()
          .then(() => addImagesCorrespondingToCoordinates())
          .then(() => pollForGameState())
      }
    }

    async function getGameState()
    {
      response = await fetch(`/get_game_state/${room_id}`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/JSON'
        },
        credentials : "include"
      })
      return response.json()
    }

    async function getCoordinates() {
      data = await getGameState()
      let safe_coordinates = data["safe_coordinates"]
      if (safe_coordinates.length > 0)
      {
        symbols = safe_coordinates
        current_move = data["current_move"]
        return true
      }
      return false
    }

    async function pollForGameState() {

    }

    async function pollForCoordinates() {
      let intervalId = setInterval(async () => {
        if (await getCoordinates()) {
          console.log("Received coordinates and coordintes have been stored")
          clearInterval()
        }
      }
    )
    }


    async function addImagesCorrespondingToCoordinates() {
    const table = document.createElement("table"); // Create a new table
    table.id = "generatedTable";
    table.style.margin = "0 auto";
    table.style.borderCollapse = "collapse";
    table.style.textAlign = "center";

    symbols.forEach(([int1, int2]) => {
      const row = table.insertRow(); // Create a new row
      const cell1 = row.insertCell(); // Create first column cell
      const cell2 = row.insertCell(); // Create second column cell

      // Create image elements for each symbol
      const img1 = document.createElement("img");
      var index1 = ""
      var index2 = ""
      if (img1 < 10){
        index1 = `0${int1}`
      }
      else {
        index1 = `${int1}`
      }

      if (img1 < 10){
        index2 = `0${int2}`
      }
      else {
        index2 = `${int2}`
      }



      img1.src = `language_symbols/elvhastian_${index1}.svg`;
      img1.alt = `Symbol ${int1}`;
      img1.style.border = "1px solid black";
      img1.style.margin = "5px";

      const img2 = document.createElement("img");
      img2.src = `path_to_directory/name_${index2}.svg`;
      img2.alt = `Symbol ${int2}`;
      img2.style.border = "1px solid black";
      img2.style.margin = "5px";

      // Append images to respective cells
      cell1.appendChild(img1);
      cell2.appendChild(img2);
      });


      // safe = symbols[loopnum] - 1;
      // coordinate1 = Math.floor(safe / 16) + 1;
      // coordinate2 = (safe % 16) + 1;
      // document.getElementById("symbol1").src = "../assets/elvhastian_" + coordinate1 + ".svg";
      // document.getElementById("symbol2").src = "../assets/elvhastian_" + coordinate2 + ".svg";
      // //Link for getting game state
      // const response = await fetch("/get_game_state/<game_room>")
      //   .then(response => response.json())
      //   .then((state) => {
      //     if (!state.game_over) {
      //       if (i >= 7) {
      //         document.getElementById("gameover").style.display = "block";
      //         document.getElementById("endgame").innerText = "You Win";
      //       } else {
      //         wait = 1000 * intervals[i];
      //         i++;
      //         SetTimeout(() => { gameloop() }, wait)
      //       }
      //     } else {
      //       document.getElementById("gameover").style.display = "block";
      //     }
      //   })
    }

    connect();
  </script>
</body>

</html>